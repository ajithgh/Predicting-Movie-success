# Importing File

## Reading CSV
```{r}
url = "https://github.com/ajithgh/Predicting-Movie-success/raw/main/rv_bud.csv"
df_movies<- read.csv(url, header = TRUE, stringsAsFactors = FALSE)
```

## Raw Data summarisation.
```{r}
head(df_movies)
dim(df_movies)
str(df_movies)
``` 

## Installing required libraries
```{r}
library(plyr)
library(readr)
library(ggplot2)
library(GGally)
library(dplyr)
library(mlbench)
library(dplyr)
library(tidyverse)
library(dataQualityR)
library(ggplot2)
library(ROSE)
library(rpart)
library(gbm)
library(mlbench)
library(caret)
library(jsonlite)
#install.packages("naniar")
library(heatmaply)
library(naniar)
library(hextri)
```

## Checking Raw Data quality
 + Script loads a file and produces a data quality report for
 + numerical variables: "dq_num.csv"
 + categorical variables: "dq_cat.cs"
```{r}
library(dataQualityR)   #dataquality package

checkDataQuality(data = df_movies, 
                 out.file.num ="dq_num.csv", 
                 out.file.cat= "dq_cat.csv")
dq_num<-read.csv("dq_num.csv")
dq_cat<-read.csv("dq_cat.csv")
dq_num
dq_cat
```

## Heat Map of Raw Data Quality
```{r}
# Can Somebody add code to this chunk? 
```

# Raw EDA

## Creating additional column 1 for those attributes that have more than 1 word separated by a comma, 0 for the attributes with a single value
+ Genre
+ Production Countries
+ Production Companies
+ Keywords
+ Director
+ Spoken Languages
```{r}
df_movies$moreThan1ProductionCountry<-ifelse(str_detect(df_movies$production_countries,",([a-zA-z])",) ,1,0)
df_movies$moreThan1Genre<-ifelse(str_detect(df_movies$genre,",([a-zA-z])",) ,1,0)
df_movies$moreThan1ProductionCompany<-ifelse(str_detect(df_movies$production_companies,",([a-zA-z])",) ,1,0)
df_movies$moreThan1Keyword<-ifelse(str_detect(df_movies$keywords,",([a-zA-z])",) ,1,0)
df_movies$moreThan1Director<-ifelse(str_detect(df_movies$director,",([a-zA-z])",) ,1,0)
df_movies$moreThanSpokenLanguage<-ifelse(str_detect(df_movies$spoken_languages,",([a-zA-z])",) ,1,0)
view(df_movies)
```

## Adding additional features
```{r}

df_movies$profit_factor = (df_movies$revenue - df_movies$budget) / df_movies$budget

df_movies$cast_crew_ratio = df_movies$cast_size / df_movies$crew_size

df_movies$target = ifelse(df_movies$profit_factor < 1, 0, ifelse(df_movies$profit_factor >= 1 & df_movies$profit_factor < 2, 1, 2))

table(df_movies$target)

```

## Heatmap 
```{r}
sum(is.na(df_movies))
colnames(is.na(df_movies))

with(na.omit(df_movies), 
  hextri(revenue, vote_average, class=target, colours=c("skyblue","grey60","goldenrod"), style="size",
            xlab="Revenue", ylab="Vote Average")
)
```

## #Removing everything adter the comma for the above columns excep "Spoken Languages"
```{r}
df_movies$production_countries<- gsub(",.*$", " ", df_movies$production_countries )
df_movies$genre<- gsub(",.*$", " ", df_movies$genre )
df_movies$production_companies<- gsub(",.*$", " ", df_movies$production_companies )
df_movies$keywords<- gsub(",.*$", " ", df_movies$keywords )
df_movies$director<- gsub(",.*$", " ", df_movies$director )
```

## Removing Data Records produced in countires that have 0 revenue and 0 budget. 
```{r}
df_movies <- subset(df_movies, (df_movies$revenue!=0 | df_movies$budget!=0))
nrow(df_movies)
write.csv(df_movies,"rv_bud.csv")
```

# Reasoning for Revenue and budget = 0
```{r}
# Aggregating based on country
countriesRevbud <-aggregate( x = df_movies[c("revenue","budget")],
                     by = list(df_movies$production_countries),
                     FUN = "mean")
view(countriesRevbud)
nrow(countriesRevbud)

#Removing Records based on countries with aggregated (Revenue = 0 and budget = 0)
countries0<-subset(countriesRevbud, (countriesRevbud$revenue!=0 & countriesRevbud$budget!=0))
view(countries0)
nrow(countries0)
neededcuntries = unique(countries0$Group.1)
neededcuntries

# Subsetting entire data based on the above list
df_movwith = subset(df_movies, (df_movies$production_countries %in% neededcuntries))
nrow(df_movwith)
``` 

